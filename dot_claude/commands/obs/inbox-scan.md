---
name: inbox-scan
description: "Сканирование изображений в Inbox, OCR распознавание и конвертация в Markdown"
category: utility
complexity: medium
mcp-servers: []
personas: []
---

# /obs:inbox-scan - Сканирование изображений в Inbox

Поиск изображений в папке 00 Inbox, распознавание текста (OCR) и конвертация в Markdown заметки.

## Triggers
- Обработка скриншотов и фотографий документов
- OCR распознавание текста с изображений
- Конвертация визуального контента в текстовые заметки

## Usage
```
/obs:inbox-scan [--preview] [--keep-image]
```

**Аргументы:**
- `--preview` — показать распознанный текст без создания файла
- `--keep-image` — не удалять оригинальное изображение после обработки

## Поддерживаемые форматы

| Формат | Расширения |
|--------|------------|
| PNG | `.png` |
| JPEG | `.jpg`, `.jpeg` |
| WebP | `.webp` |
| GIF | `.gif` |
| HEIC | `.heic` (iPhone) |

## Behavioral Flow

Когда пользователь вызывает `/obs:inbox-scan`:

1. **Сканирование Inbox на изображения**
   ```bash
   ls -la "00 Inbox/" | grep -iE "\.(png|jpg|jpeg|webp|gif|heic)$"
   ```

2. **Для каждого изображения**:
   - Прочитать изображение через Read tool (Claude мультимодальный)
   - Распознать текст на изображении (OCR)
   - Определить тип контента:
     | Контент на изображении | Тип | Целевая папка |
     |------------------------|-----|---------------|
     | Код, терминал, IDE | `snippet` | `60 Resources/Code Snippets/` |
     | Команды, CLI справка | `cheatsheet` | `60 Resources/Cheatsheets/` |
     | Статья, документация | `wiki` | `30 Wiki/` |
     | Список задач, план | `project` | `20 Projects/` |
     | Ссылки, QR-код | `bookmark` | `60 Resources/Bookmarks/` |
     | Рабочая задача, тикет | `work-task` | `50 Areas/Work/Active/` |
     | Рецепт на очки (SPH, CYL, AX) | `glasses-prescription` | `50 Areas/Health/Vision/` |
     | Медицинский документ | `medical` | `50 Areas/Health/Medical/` |
     | Заметка, текст | определить по содержимому | соответствующая папка |

3. **Показать пользователю через AskUserQuestion**:
   - Превью распознанного текста (первые 500 символов)
   - Предложить тип и целевую папку
   - Предложить название файла
   - Спросить: сохранить как .md или нужна корректировка

4. **После подтверждения**:
   - Создать Markdown файл с frontmatter:
     ```yaml
     ---
     created: YYYY-MM-DD
     updated: YYYY-MM-DD
     type: <тип>
     tags: [<тег1>, <тег2>]
     source: ocr
     original_file: <имя_изображения>
     ---
     ```
   - Сохранить заметку в целевую папку
   - **Переместить изображение** в `99 System/Attachments/Images/`
   - Вставить ссылку на изображение: `![[filename.jpeg]]`
   - Удалить из Inbox (изображение уже в Attachments)

5. **Повторить** для всех изображений в Inbox

## Пример распознавания

### Скриншот терминала
**Изображение:** `screenshot-2026-01-16.png`

**Распознанный текст:**
```
$ kubectl get pods -n production
NAME                    READY   STATUS    RESTARTS
api-7d4f8b6c9-x2k4m    1/1     Running   0
web-5c6d7e8f9-y3l5n    1/1     Running   0
```

**Результат:**
- Тип: `snippet`
- Папка: `60 Resources/Code Snippets/`
- Имя: `Kubectl Get Pods.md`
- Теги: `[snippet, kubernetes, cli]`

---

### Фото документа
**Изображение:** `IMG_1234.heic`

**Распознанный текст:**
```
Архитектура микросервисов

1. API Gateway - точка входа
2. Auth Service - аутентификация
3. User Service - управление пользователями
...
```

**Результат:**
- Тип: `wiki`
- Папка: `30 Wiki/`
- Имя: `Microservices Architecture.md`
- Теги: `[wiki, architecture, microservices]`

---

### Рецепт на очки
**Изображение:** `glasses-prescription.jpeg`

**Распознанный текст:**
```
OD: SPH -2.25 CYL -0.75 AX 180
OS: SPH -2.50 CYL -0.50 AX 175
PD: 64mm
```

**Результат:**
- Тип: `glasses-prescription`
- Папка: `50 Areas/Health/Vision/`
- Имя: `Glasses Prescription 2026-01.md`
- Теги: `[health, vision]`
- Использовать шаблон: `40 Templates/Glasses Prescription.md`

## Frontmatter для OCR заметок

```yaml
---
created: 2026-01-16
updated: 2026-01-16
type: <тип>
tags: [<теги>]
source: ocr
original_file: screenshot-2026-01-16.png
---
```

Поле `source: ocr` указывает что заметка создана из изображения.

## Обработка сложных случаев

### Нечитаемый текст
Если текст на изображении нечёткий или частично распознан:
1. Показать что удалось распознать
2. Предложить оставить изображение и создать заметку-ссылку на него

### Смешанный контент (текст + диаграммы)
1. Распознать текстовую часть
2. Переместить изображение в `99 System/Attachments/Images/`
3. Вставить ссылку на изображение в Markdown: `![[image.png]]`

### QR-коды и ссылки
1. Распознать URL из QR-кода или текста
2. Создать bookmark с полем `url:`

## Советы

- **Качество распознавания** зависит от качества изображения
- **Скриншоты** распознаются лучше чем фото
- **Рукописный текст** может распознаваться с ошибками — проверяйте результат
- Используй `--preview` чтобы проверить распознавание перед сохранением

## Хранение вложений

Все изображения сохраняются в:
```
99 System/Attachments/
├── Images/      # PNG, JPG, JPEG, HEIC, WebP, GIF
├── Documents/   # PDF, DOCX
├── Audio/       # MP3, M4A
└── Other/       # Остальное
```

Рекомендуемое именование: `<категория>-<описание>-<дата>.<ext>`
- `health-glasses-prescription-2026-01.jpeg`
- `work-screenshot-jenkins-2026-01-16.png`

## Обработка ошибок

| Ситуация | Действие |
|----------|----------|
| Нет изображений в Inbox | Сообщить пользователю, предложить `/obs:inbox` |
| Изображение повреждено | Пропустить с предупреждением |
| OCR не распознал текст | Предложить сохранить как attachment без конвертации |
| Дублирующееся имя файла | Добавить временной suffix (timestamp) |

## Связанные команды

- `/obs:inbox` — обработка текстовых заметок в Inbox
- `/obs:learn` — генерация знаний и сохранение в vault
